name: schwab_spx_only_test
on:
  workflow_dispatch:
    inputs:
      for_date:
        description: "Trading date (YYYY-MM-DD, ET). Example: 2025-11-07"
        required: true
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - name: Install deps
        run: |
          python -m pip install --upgrade pip
          pip install pandas pytz schwab-py
      - name: Write SPX-only test script
        run: |
          mkdir -p scripts/trade/accelerator
          cat > scripts/trade/accelerator/test_schwab_spx_only.py << 'PY'
          # (PASTE THE FULL PYTHON CONTENT FROM ABOVE HERE)
          PY
          chmod +x scripts/trade/accelerator/test_schwab_spx_only.py
      - name: Run SPX-only test
        env:
          SCHWAB_APP_KEY:    ${{ secrets.SCHWAB_APP_KEY }}
          SCHWAB_APP_SECRET: ${{ secrets.SCHWAB_APP_SECRET }}
          SCHWAB_TOKEN_JSON: ${{ secrets.SCHWAB_TOKEN_JSON }}
          FOR_DATE:          ${{ inputs.for_date }}
        run: python -u scripts/trade/accelerator/test_schwab_spx_only.py
